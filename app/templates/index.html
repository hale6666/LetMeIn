<!DOCTYPE html>
<html>
  <head>
    <title>CSH: Let me in!!!!</title>
    <script src='https://www.google.com/recaptcha/api.js'></script>
    <style>
      body {
        background-color: #152d54;
        display: flex;
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
      }

      p {
        font-size: 4rem;
        color: white;
      }

      #waitingStatus,
      #comingStatus,
      #timedOutStatus,
      #buttonContainer {
        margin: auto;
      }

      #waitingStatus,
      #comingStatus,
      #timedOutStatus {
        display: none;
      }

      img {
        display: block;
        width: 100%;
      }

      button {
        background-color: #635192;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: block;
        font-size: 5rem;
        margin: 5rem 0;
        cursor: pointer;
        width: 100%;
      }
    </style>
    <script>
      function onLoad(){
        var element1 = document.getElementById('butt');
        var elementA = document.getElementById('levelA');
        element1.onclick = validate1;
        elementA.onclick = validateA;
      }
      function validate1(event){
        event.preventDefault();
        grecaptcha.execute();
      }
      function validateA(event){
        event.preventDefault();
        grecaptcha.execute();
      }
      function showElem(id) {
        document.getElementById(id).style.display = "initial";
      }
      function hideElem(id) {
        document.getElementById(id).style.display = "none";
      }
      function hideButtons() {
        hideElem("buttonContainer");
      }
      function letInA(token){
        letIn('aLevel')
      }
      function letIn1(token){
        letIn('1Level')
      }
      function letIn(level) {
        showElem("waitingStatus");
        hideButtons();
        fetch(`/activate?level=${level}`, {method: 'POST'})
          .then(resp => {
            if (resp.ok) {
                hideElem("waitingStatus");
                return resp.text().then(text => {
                    if (text === "timeout") {
                        showElem("timedOutStatus");
                    } else if (text === "buttonpressed") {
                        showElem("comingStatus");
                    }
                });
            }
        })
      }
    </script>
  </head>
  <body>
    <div id="waitingStatus">
      <p>
        Notifying User Center...
      </p>
      <img src="https://media0.giphy.com/media/yx400dIdkwWdsCgWYp/giphy.gif"/>
    </div>
    <div id="comingStatus">
      <p>
        Someone is coming to let you in!
      </p>
      <img src="https://media0.giphy.com/media/Sti3xU9WslS95nIoox/giphy.gif" />
    </div>
    <div id="timedOutStatus">
      <p>
        Nobody responded to the request.<br />
        <br />
        Thank you, or, I'm sorry.
      </p>
      <img src="https://media0.giphy.com/media/3oEjI80DSa1grNPTDq/giphy.gif" />
    </div>
    <div id="buttonContainer">
      <button id="butt" class="g-recaptcha"
        data-sitekey="6LcxrbYUAAAAAL4BM_lgfQVX0H5t1HlsCI647-HO"
        data-callback="letIn1">Let me in: Level 1!!!</button>
      <button id="levelA" class="g-recaptcha"
        data-sitekey="6LcxrbYUAAAAAL4BM_lgfQVX0H5t1HlsCI647-HO"
        data-callback="letInA">Let me in: Level A!!!</button>
      <script>onLoad()</script>
    </div>
  </body>
</html>

